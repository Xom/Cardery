<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cardery</title>
    <link rel="stylesheet" type="text/css" href="lib/normalize.css">
    <link rel="stylesheet" type="text/css" href="lib/cardery.css">
    <script defer type="text/javascript" src="lib/jquery-3.1.1.slim.js"></script>
    <script defer type="text/javascript" src="lib/lodash.js"></script>
    <script defer type="text/javascript" src="lib/handlebars-v4.0.5.js"></script>
    <script defer type="text/javascript" src="lib/swag.js"></script>
    <script defer type="text/javascript" src="lib/papaparse.js"></script>
    <script defer type="text/javascript" src="lib/dom-to-image.js"></script>
    <script defer type="text/javascript" src="lib/jszip.js"></script>
    <script defer type="text/javascript" src="lib/FileSaver.js"></script>
    <script defer type="text/javascript" src="lib/cardery.js"></script>
  </head>
  <body>
    <div id="editDiv">
      <div id="codeDiv" class="textContainer">
        <div id="jsDiv" class="textEditor">
          <div id="jsLines" class="lineNumbers">1</div>
          <textarea id="jsText" spellcheck="false">var Demo = {};

Demo.main = function(x, cdata) {
  var card = $(`<div>
    <div class="cardback"/>
    <div class="cardname">${cdata.cardname}</div>
    <div class="cardimgdiv"/>
    <div class="cardtext">${cdata.description} </div>
  </div>`);
  CCC.preview(x, card);

  var cardImgDiv = card.find('.cardimgdiv');
  var cardText = card.find('.cardtext');

  var imgSrc = CCC.images[Demo.filename(cdata.cardname)];
  cardImgDiv.append($('<img>', {'class': 'cardimg', src: imgSrc}));
  cardText.append($('<img>', {src: imgSrc}));

  var fontSize = 16;
  cardText.css('font-size', `${fontSize}px`);

  while (cardText.innerHeight() >= 100) {
    fontSize -= 1;
    if (fontSize > 10) {
      fontSize -= 1;
    }
    cardText.css('font-size', `${fontSize}px`);
  }

  return card;
};

Demo.spaces = / /g;

Demo.filename = function(name) {
  return name.replace(Demo.spaces, '_') + '.png';
};

CCC.setRenderOptions({width: 198, height: 270});
CCC.setMain(Demo.main);</textarea>
        </div>
        <div id="cssDiv" class="textEditor">
          <div id="cssLines" class="lineNumbers">1</div>
          <textarea id="cssText" spellcheck="false">.card {
  position: relative;
  width: 198px;
  height: 270px;
  overflow: hidden;
}

.cardback {
  position: absolute;
  bottom: 9px;
  left: 9px;
  right: 9px;
  top: 9px;
  z-index: -20;
  border-radius: 9px;
  background-color: #eee;
}

.cardname {
  position: absolute;
  bottom: 231px;
  left: 0;
  right: 0;
  text-align: center;
  font-size: 18px;
}

.cardimgdiv {
  position: absolute;
  bottom: 130px;
  left: 20px;
  right: 20px;
  top: 50px;
  text-align: center;
}

.cardimg {
  height: 100%;
  image-rendering: pixelated;
}

.cardtext img {
  height: 1em;      /* Same height as a line of text */
  margin-top: -1px; /* Without this, the image distorts the line-height by 1px
                       regardless of the font size. */
}

.cardtext {
  position: absolute;
  left: 20px;
  right: 20px;
  top: 150px;
  font-style: italic;
}</textarea>
        </div>
      </div>
      <div id="dataDiv" class="textContainer">
        <div id="csvDiv" class="textEditor">
          <div id="csvLines" class="lineNumbers">1</div>
          <textarea id="csvText" spellcheck="false">cardname,description
Sigmund,"The elder of a pair of brothers who came for the Orb. No one knows what Sigmund saw in the dungeon to drive him mad, but his shrewd magical tactics and wicked scythe now leave little time for his victims to wonder. Despite his reputation as a vicious murderer, his grandiose and dramatic ways have earned him the admiration of many denizens of the dungeon."
Terence,"A violent murderer who kills for both pleasure and profit, Terence has been forced into hiding after a botched job. There's a price on his head, and he can't afford to leave anyone who sees him alive!"
Ijyb,"A small and twisted goblin, wearing some ugly blue rags. He claims dominion over this level of the dungeon; the punishment for trespassing is death."
Jessica,"An evil apprentice sorceress. She entered the dungeon hoping to find a quiet, secluded place where she could study the darker arts without being disturbed."
Grinder,"An inefficient shadow imp previously employed as a torturer in one of the lower circles of Hell. He has a tendency to complain and make inane statements."
Crazy Yiuf,"A withered old gnoll with a long silver beard, wielding a quarterstaff and wearing a cloak. He looks like a figure from mythology! Wait, is his beard held on to his ears with hooks?"
Blork the orc,"A particularly fat and ugly orc. He's scavenged a pair of rainbow-coloured suspenders from somewhere. They're not helping."
Duvessa,"A plain-looking elven fighter who is technically brilliant in many forms of combat, but over-confident because of it. She is complemented by the magical skills of her twin brother, Dowan."
Prince Ribbit,"A frog of unusual size, with a tiny crown perched incongruously atop his head."</textarea>
        </div>
      </div>
    </div>
    <div id="ctrlDiv">
      <div id="buttonsDiv">
        <button id="generateAllButton">Generate All</button>
        <button id="generateTestButton">Generate Test</button>
        <a href="index.html" target="_blank">README</a>
        <br>
        Local image files (multi-select): <input type="file" id="imgLoader" multiple/>
        <button id="clearImagesButton">Clear Loaded Files</button>
      </div>
      <div id="tabsDiv">
        <form id="tabsForm">
          <label><input id="codeTab" type="radio" name="editor" value="jscss" checked>JS/CSS</label>
          <label><input id="dataTab" type="radio" name="editor" value="csv">CSV</label>
        </form>
      </div>
    </div>
    <div id="viewDiv">
      <center>
        <h1>Cardery</h1>
        <p>Make cards with HTML, CSS, JS, and CSV.</p>
        <p>by <a href="https://twitter.com/deCardery">Michael de Cardery</a>, a.k.a. "Xom"</p>
        <p><a href="https://github.com/Xomnom/Cardery">Available on GitHub</a> under the <a href="LICENSE">MIT License</a>.</p>
        <br>
        <p><i>To run the demo, use the files chooser to load the images in the demo folder, then click "Generate"!</i></p>
      </center>
    </div>
  </body>
</html>

